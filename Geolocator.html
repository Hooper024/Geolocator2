<!DOCTYPE html>
<html>
<head>
  <title>Distance Checker</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 75vh; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #controls, #distances { padding: 10px; }
    input { margin-right: 5px; padding: 5px; }
    button { padding: 5px 10px; }
    ul { list-style-type: none; padding-left: 0; }
    li { margin-bottom: 4px; }
    .red { color: red; }
    .green { color: green; }
  </style>
</head>
<body>
  <div id="controls">
    <h3>Add / Remove Point</h3>
    <input type="number" step="any" id="latInput" placeholder="Latitude">
    <input type="number" step="any" id="lngInput" placeholder="Longitude">
    <button onclick="addNewPoint()">Add Point</button>
    <select id="deleteSelect"></select>
    <button onclick="deleteSelectedPoint()">Delete Selected Point</button>
  </div>

  <div id="map"></div>
  <div id="distances">
    <h3>Distances Between All Points</h3>
    <ul id="distanceList"></ul>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let allPoints = [
  { name: "Point 1", lat: -8.139957, lng: 36.669067 },
  { name: "Point 2", lat: -8.136673, lng: 36.664277 },
  { name: "Point 3", lat: -8.134107, lng: 36.669272 },
  { name: "Point 4", lat: -8.127067, lng: 36.668128 },
  { name: "Point 5", lat: -8.147755, lng: 36.669503 },
  { name: "Point 6", lat: -8.152952, lng: 36.668628 },
  { name: "Point 7", lat: -8.16065, lng: 36.671715 },
  { name: "Point 8", lat: -8.145208, lng: 36.664078 },
  { name: "Point 9", lat: -8.140587, lng: 36.658875 },
  { name: "Point 10", lat: -8.144478, lng: 36.655602 },
  { name: "Point 11", lat: -8.152707, lng: 36.65118 },
  { name: "Point 12", lat: -8.14853, lng: 36.646268 },
  { name: "Point 13", lat: -8.144678, lng: 36.637868 },
  { name: "Point 14", lat: -8.14199, lng: 36.646127 },
  { name: "Point 15", lat: -8.131433, lng: 36.645023 },
  { name: "Point 16", lat: -8.135677, lng: 36.684902 },
  { name: "Point 17", lat: -8.141285, lng: 36.678193 },
  { name: "Point 18", lat: -8.146768, lng: 36.679448 },
  { name: "Point 19", lat: -8.129183, lng: 36.675567 },
  { name: "Point 20", lat: -8.133372, lng: 36.679662 },
  { name: "Point 21", lat: -8.118925, lng: 36.683908 },
  { name: "Point 22", lat: -8.122098, lng: 36.676527 },
  { name: "Point 23", lat: -8.126647, lng: 36.682575 },
  { name: "Point 24", lat: -8.124133, lng: 36.69217 },
  { name: "Point 25", lat: -8.128393, lng: 36.69712 },
  { name: "Point 26", lat: -8.09519, lng: 36.59895 },
  { name: "Point 27", lat: -8.091442, lng: 36.584242 },
  { name: "Point 28", lat: -8.088058, lng: 36.565937 },
  { name: "Point 29", lat: -8.089595, lng: 36.571963 },
  { name: "Point 30", lat: -8.095883, lng: 36.576907 },
  { name: "Point 31", lat: -8.095608, lng: 36.605252 },
  { name: "Point 32", lat: -8.10159, lng: 36.610892 },
  { name: "Point 33", lat: -8.141377, lng: 36.704998 },
  { name: "Point 34", lat: -8.149758, lng: 36.695585 },
  { name: "Point 35", lat: -8.145618, lng: 36.692782 },
  { name: "Point 36", lat: -8.145273, lng: 36.698802 },
  { name: "Point 37", lat: -8.164807, lng: 36.681247 },
  { name: "Point 38", lat: -8.160658, lng: 36.68477 },
  { name: "Point 39", lat: -8.15237, lng: 36.683132 },
  { name: "Point 40", lat: -8.147742, lng: 36.685317 },
  { name: "Point 41", lat: -8.151388, lng: 36.689433 },
  { name: "Point 42", lat: -8.140122, lng: 36.695068 }
];


    const markers = [];
    const lines = [];

    function haversine(lat1, lng1, lat2, lng2) {
      const R = 6371;
      const toRad = deg => deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLng = toRad(lng2 - lng1);
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLng / 2) ** 2;
      return 2 * R * Math.asin(Math.sqrt(a));
    }

    const map = L.map('map').setView([-8.14, 36.67], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

    function addMarker(p) {
      const marker = L.marker([p.lat, p.lng]).addTo(map);
      marker.bindPopup('${p.name}<br>(${p.lat.toFixed(5)}, ${p.lng.toFixed(5)})');
      markers.push(marker);
    }

    function updateDropdown() {
      const select = document.getElementById("deleteSelect");
      select.innerHTML = "";
      allPoints.forEach((p, idx) => {
        const option = document.createElement("option");
        option.value = idx;
        option.textContent = p.name;
        select.appendChild(option);
      });
    }

    function drawLinesAndDistances() {
      const ul = document.getElementById("distanceList");
      ul.innerHTML = "";
      lines.forEach(line => map.removeLayer(line));
      lines.length = 0;

      for (let i = 0; i < allPoints.length; i++) {
        for (let j = i + 1; j < allPoints.length; j++) {
          const p1 = allPoints[i];
          const p2 = allPoints[j];
          const d = haversine(p1.lat, p1.lng, p2.lat, p2.lng);
          const color = d < 0.5 ? 'red' : 'green';

          const li = document.createElement("li");
          li.textContent = '${p1.name} ↔ ${p2.name}: ${d.toFixed(3)} km';
          li.className = color;
          ul.appendChild(li);

          const line = L.polyline([[p1.lat, p1.lng], [p2.lat, p2.lng]], { color }).addTo(map);
          line.bindPopup('${p1.name} ↔ ${p2.name}<br>${d.toFixed(3)} km)');
          lines.push(line);
        }
      }
    }

    function addNewPoint() {
      if (allPoints.length >= 97) {
        alert("Maximum of 97 points reached.");
        return;
      }

      const lat = parseFloat(document.getElementById("latInput").value);
      const lng = parseFloat(document.getElementById("lngInput").value);
      if (isNaN(lat) || isNaN(lng)) {
        alert("Please enter valid coordinates.");
        return;
      }

      const name = 'Point ${allPoints.length + 1}';
      const newPoint = { name, lat, lng };
      allPoints.push(newPoint);
      addMarker(newPoint);
      updateDropdown();
      drawLinesAndDistances();

      document.getElementById("latInput").value = '';
      document.getElementById("lngInput").value = '';
    }

    function deleteSelectedPoint() {
      const select = document.getElementById("deleteSelect");
      const index = parseInt(select.value);
      if (isNaN(index)) return;

      map.removeLayer(markers[index]);
      markers.splice(index, 1);
      allPoints.splice(index, 1);

      updateDropdown();
      drawLinesAndDistances();
    }

    allPoints.forEach(addMarker);
    updateDropdown();
    drawLinesAndDistances();
  </script>
</body>
</html>